<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>記事登録</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

	<div th:replace="~{discard/fragments/header :: header}"></div>
	<div th:if="ArticleForm.isNew" class="p-3">
		<h1>記事投稿フォーム</h1>
	</div>
	<div th:unless="ArticleForm.isNew" class="p-3">
		<h1>記事編集フォーム</h1>
	</div>
	<div th:if="${errorMessage}" class="alert alert-danger" role="alert">
	    <span th:text="${errorMessage}"></span>
	</div>

	<form th:action="@{/discard/saveArticle}" method="post" th:object="${articleForm}" enctype="multipart/form-data">
		<ul th:if="${#fields.hasErrors('*')}">
			<li th:each="err:${#fields.errors('*')}" th:text="${err}" class="alert alert-danger"></li>
		</ul>

		<input type="hidden" name="date" th:value="${#dates.format(articleForm.date, 'yyyy-MM-dd')}">
	    <div class="p-3">
	        <label class="form-label">投稿日</label>
			<p class="form-control-plaintext" th:text="*{#dates.format(date, 'yyyy年MM月dd日')}"></p>
	    </div>
		
	    <div class="p-3">
	        <label for="title" class="form-label">タイトル</label>
	        <input type="text" id="title" class="form-control" th:field="*{title}">
	    </div>

	    <div class="p-3">
	        <label for="imageFile" class="form-label">画像</label>
	        <input type="file" id="imageFile" class="form-control" th:field="*{imageFile}" accept="image/*">
	    </div>
		<div th:unless="*{isNew}">
		    <label class="form-label">現在の画像</label>
		    <div>
		        <img th:if="*{storedImageFileName != null}"
		             th:src="@{/image/{filename}(filename=*{storedImageFileName})}" 
		             class="img-thumbnail" width="300" alt="現在の画像">
		        <span th:if="*{storedImageFileName == null}">画像がありません</span>
		    </div>
		</div>

	    <div class="p-3">
	        <label for="category" class="form-label">ゴミ種別</label>
	        <select id="category" class="form-select" th:field="*{trashTypeId}">
	            <option value="">選択してください</option>
	            <option th:each="type : ${trashTypes}" th:value="${type.id}" th:text="${type.name}"></option>
	        </select>
	    </div>
	    
	    <div class="p-3">
	        <label for="tag" class="form-label">ゴミ出し労力</label>
	        <select id="tag" class="form-select" th:field="*{effortId}">
	            <option value="">選択してください</option>
	            <option th:each="type : ${efforts}" th:value="${type.id}" th:text="${type.name}"></option>
	        </select>
	    </div>

	    <button type="submit" class="btn btn-primary mb-3">投稿する</button>
	</form>
	<a th:href="@{/discard}">キャンセル</a>
	
	<div th:replace="~{discard/fragments/footer :: footer}"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>